{% extends "base.html.twig" %}

{% block title %}
	{{ titre_doc }}
{% endblock %}

{% block content %}
	<h1 class="text-center my-4">{{ article["titre"] }}</h1>

	<div class="mx-4">
		<p class="mb-3">Date de mise à jour :
			{{ article["date_mise_a_jour"]|date('d/m/Y H:i') }}</p>
		{% if article.image_une %}
			<img src="{{ base_url }}{{ article.image_une }}" class="img-fluid mb-4 rounded" alt="{{ article.titre }}">
		{% endif %}


		{{ article['contenu_html'] | raw}}

		<h3 class="mt-5 mb-4 border-bottom pb-2">Commentaires</h3>

		<div class="comments-section mb-5">
			{% if comments %}
				{% for comment in comments %}
					<div class="card mb-3 shadow-sm">
						<div class="card-body">
							<div class="d-flex justify-content-between align-items-center mb-2">
								<h5 class="card-title mb-0">{{ comment.nom_auteur }}</h5>
								<small class="text-muted">{{ comment.date_commentaire|date('d/m/Y H:i') }}</small>
							</div>
							<p class="card-text text-muted">{{ comment.contenu|nl2br }}</p>
							<!-- #nl2br transforme les retours à la ligne en balises <br> -->
						</div>
					</div>
				{% endfor %}
			{% else %}
				<div class="alert alert-secondary card text-muted" role="alert">
					Aucun commentaire pour cet article. Soyez le premier à commenter !
				</div>
			{% endif %}
		</div>


		<!-- Formulaire d'ajout de commentaire -->
		<div class="card mb-4">
			<div class="card-body">
				<h5 class="card-title">Laisser un commentaire</h5>
				<form action="{{ base_url }}comment/submit" method="POST">
					<input type="hidden" name="article_id" value="{{ article.id }}">
					<input type="hidden" name="article_slug" value="{{ article.slug }}">

					{% if not session.user %}
						<div class="row mb-3">
							<div class="col-md-6">
								<label for="author_name" class="form-label">Nom *</label>
								<input type="text" class="form-control" id="author_name" name="author_name" required>
							</div>
							<div class="col-md-6">
								<label for="author_email" class="form-label">Email *</label>
								<input type="email" class="form-control" id="author_email" name="author_email" required>
							</div>
						</div>
					{% else %}
						<p class="mb-3 text-muted">Connecté en tant que
							<strong>{{ session.user.nom_utilisateur }}</strong>
						</p>
					{% endif %}

					<div class="mb-3">
						<label for="content" class="form-label">Votre message *</label>
						<textarea class="form-control" id="content" name="content" rows="3" required></textarea>
					</div>
					<button type="submit" class="btn btn-primary">Envoyer</button>
				</form>
			</div>
		</div>
	</div>
{% endblock %}
